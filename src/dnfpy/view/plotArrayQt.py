import numpy as np
import qimage2ndarray #http://kogs-www.informatik.uni-hamburg.de/~meine/software/qimage2ndarray/doc/#converting-ndarrays-into-qimages
#import json

#def getColorMap(nameCm='RdYlBu_r'):
#        folder = 'stylesheet/'
#        f = open(folder+nameCm+'.cm','r')
#        array = json.load(f)
#        return array
#

#__cm = getColorMap()
__cm = [4281415317, 4281481366, 4281547671, 4281548185, 4281614490, 4281680539, 4281746844, 4281747358, 4281813663, 4281879712, 4281946017, 4282012066, 4282012836, 4282078885, 4282145190, 4282211239, 4282277544, 4282278058, 4282344107, 4282410412, 4282476461, 4282477231, 4282543280, 4282609585, 4282675634, 4282741939, 4282807989, 4282939574, 4283071159, 4283137464, 4283269049, 4283400634, 4283532219, 4283663805, 4283795646, 4283927231, 4283993280, 4284124865, 4284256450, 4284388291, 4284519876, 4284651462, 4284717511, 4284849096, 4284980937, 4285112522, 4285244107, 4285375692, 4285441742, 4285573583, 4285705168, 4285836753, 4285968338, 4286099667, 4286231252, 4286428373, 4286559958, 4286691287, 4286822872, 4286954457, 4287086041, 4287282906, 4287414491, 4287546076, 4287677405, 4287808990, 4287940575, 4288137696, 4288269025, 4288400610, 4288532195, 4288663780, 4288795109, 4288926694, 4289123815, 4289255144, 4289386729, 4289518313, 4289649642, 4289780970, 4289912299, 4290043628, 4290174956, 4290371821, 4290503149, 4290634478, 4290765807, 4290897135, 4291028464, 4291159792, 4291291121, 4291422450, 4291553778, 4291685107, 4291816435, 4291947764, 4292144628, 4292275957, 4292407286, 4292538614, 4292669943, 4292801271, 4292932600, 4292998134, 4293063924, 4293194993, 4293260783, 4293326317, 4293392107, 4293523176, 4293588966, 4293654500, 4293720290, 4293785823, 4293917149, 4293982683, 4294048473, 4294114006, 4294179796, 4294310866, 4294376400, 4294442190, 4294507723, 4294639049, 4294704583, 4294770373, 4294835906, 4294901696, 4294966974, 4294966716, 4294966458, 4294966201, 4294965943, 4294965429, 4294965171, 4294964913, 4294964655, 4294964141, 4294963884, 4294963626, 4294963368, 4294897574, 4294897060, 4294896802, 4294896545, 4294896287, 4294896029, 4294895515, 4294895257, 4294894999, 4294894742, 4294894228, 4294893970, 4294893712, 4294893198, 4294892684, 4294892170, 4294891657, 4294891143, 4294890629, 4294890115, 4294889601, 4294889087, 4294888574, 4294888060, 4294887546, 4294821752, 4294821238, 4294820724, 4294820211, 4294819697, 4294819183, 4294818669, 4294818155, 4294817641, 4294817127, 4294816614, 4294816100, 4294815586, 4294815072, 4294748767, 4294748254, 4294747485, 4294681436, 4294680667, 4294679897, 4294613848, 4294613079, 4294612566, 4294546261, 4294545747, 4294544978, 4294478929, 4294478160, 4294477391, 4294411342, 4294410572, 4294344523, 4294343754, 4294343241, 4294276936, 4294276423, 4294275653, 4294209604, 4294208835, 4294142786, 4294076481, 4294010432, 4293878591, 4293812542, 4293746492, 4293680187, 4293614138, 4293547833, 4293481784, 4293350199, 4293283894, 4293217845, 4293151796, 4293085491, 4293019441, 4292953136, 4292887087, 4292755502, 4292689197, 4292623148, 4292556843, 4292490794, 4292424745, 4292358440, 4292226855, 4292095271, 4291963687, 4291832103, 4291700775, 4291569191, 4291437607, 4291306023, 4291174439, 4291042855, 4290911271, 4290779687, 4290648103, 4290582310, 4290450726, 4290319142, 4290187558, 4290055974, 4289924390, 4289792806, 4289661222, 4289529894, 4289398310, 4289266726, 4289135142, 4289003558]


def npToQImage(array):
        min_ = np.min(array)
        max_ = np.max(array)
        return npToQImage2(array,min_,max_)


def npToQImage2(array,minArray,maxArray):
        """
                Transform the array into a qImage with color map
                return QImage
        """
        if len(array.shape) == 3 and array.shape[2] == 3:
                qImage = qimage2ndarray.array2qimage(array).rgbSwapped()
        else:
            if minArray == maxArray:
                max_a = 10e-10
            else:
                max_a = max(abs(minArray),abs(maxArray))
            qImage = qimage2ndarray.gray2qimage(array,(-max_a,max_a))
            qImage.setColorTable(__cm)

        return qImage
